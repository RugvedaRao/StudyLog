<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CA Foundation Tracker</title>

  <style>
    :root{
      --bg:#0b1020;
      --text:#e8eefc;
      --muted:#a8b7d8;
      --border: 1px solid rgba(255,255,255,.10);
      --shadow: 0 18px 40px rgba(0,0,0,.35);
      --radius:18px;

      --green:#22c55e;     /* progress color */
      --accent:#38bdf8;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 800px at 15% 15%, rgba(34,197,94,.10), transparent 55%),
        radial-gradient(900px 600px at 85% 25%, rgba(56,189,248,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:26px 16px;
    }

    .app{
      width:min(1100px, 100%);
      border-radius: 26px;
      overflow:hidden;
      border: var(--border);
      box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,0));
    }

    /* Header ribbon */
    .hero{
      padding:22px 22px 18px;
      background: linear-gradient(90deg, rgba(34,197,94,.45), rgba(56,189,248,.45));
      position:relative;
    }
    .hero:after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.45));
      pointer-events:none;
    }
    .hero-inner{
      position:relative;
      z-index:1;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand h1{
      margin:0;
      font-size:24px;
      font-weight:900;
      letter-spacing:.2px;
    }

    /* Countdown pill on ribbon right */
    .countdownPill{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(8px);
      user-select:none;
    }
    .countdownPill .label{
      font-weight:900;
      font-size:12px;
      color: rgba(255,255,255,.88);
      letter-spacing:.6px;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .countdownPill .time{
      font-weight:900;
      font-size:14px;
      color: rgba(255,255,255,.96);
      white-space:nowrap;
      cursor:pointer; /* ONLY this is clickable after set */
      padding:2px 6px;
      border-radius: 10px;
    }
    .countdownPill .time:hover{
      background: rgba(255,255,255,.08);
    }
    .countdownPill .hint{
      font-weight:800;
      font-size:12px;
      color: rgba(255,255,255,.70);
      margin-left:2px;
      white-space:nowrap;
    }

    .content{ padding:20px 22px 28px; }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
      border: var(--border);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
    }

    .titleRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:14px;
      gap:12px;
    }
    .titleRow .title{
      font-weight:900;
      font-size:18px;
    }

    .metersGrid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
    }

    .meterCard{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding:14px 12px 12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;
    }

    .ring{
      width:120px;
      height:120px;
      border-radius:999px;
      display:grid;
      place-items:center;
      position:relative;
      background: rgba(0,0,0,.16);
      border: 1px solid rgba(255,255,255,.14);
    }
    .ring .pct{
      position:absolute;
      font-weight:900;
      font-size:22px;
      color: rgba(255,255,255,.95);
    }
    .ring svg{ display:block; }

    .subjectName{
      font-weight:900;
      font-size:15px;
      color: rgba(255,255,255,.95);
      cursor:pointer;
      user-select:none;
      text-align:center;
      line-height:1.2;
    }
    .subjectName:hover{ text-decoration: underline; }

    .doneText{
      color: var(--muted);
      font-weight:800;
      font-size:13px;
    }

    .overallBelow{
      margin-top:14px;
      text-align:right;
      font-weight:900;
      font-size:14px;
      color: rgba(255,255,255,.88);
    }
    .overallBelow span{
      color: var(--muted);
      font-weight:800;
      font-size:13px;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:12px;
    }
    .back{
      display:inline-flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      user-select:none;
      font-weight:900;
      font-size:14px;
      color: rgba(255,255,255,.92);
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.14);
      padding:10px 12px;
      border-radius: 12px;
    }

    .subjectHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .subjectHeader h2{
      margin:0;
      font-size:18px;
      font-weight:900;
    }
    .subjectHeader .right{
      color: var(--muted);
      font-weight:900;
      font-size:14px;
    }

    .topics{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }

    .topicRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
    }

    .topicRow .topicName{
      font-weight:800;
      font-size:14px;
      line-height:1.35;
      color: rgba(255,255,255,.95);
    }

    .topicRow input[type="checkbox"]{
      width:20px;
      height:20px;
      accent-color: var(--green);
      flex:0 0 auto;
      cursor:pointer;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top:14px;
      flex-wrap:wrap;
    }
    button{
      border:none;
      border-radius: 10px;
      padding:10px 12px;
      font-weight:900;
      font-size:14px;
      cursor:pointer;
      color:#061223;
      background: linear-gradient(90deg, var(--green), var(--accent));
    }
    button.secondary{
      color: rgba(255,255,255,.92);
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.14);
    }

    .hidden{ display:none !important; }

    @media (max-width: 980px){
      .metersGrid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 520px){
      .metersGrid{ grid-template-columns: 1fr; }
      .ring{ width:128px; height:128px; }
      .ring .pct{ font-size:24px; }
      .countdownPill .hint{ display:none; }
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="hero">
      <div class="hero-inner">
        <div class="brand">
          <h1>CA Foundation Tracker</h1>
        </div>

        <!-- Countdown in ribbon right side -->
        <div class="countdownPill" id="countdownPill" aria-label="Exam countdown">
          <div class="label" id="countdownLabel">Set Exam Date</div>
          <div class="time" id="countdownTime">--d --:--:--</div>
          <div class="hint" id="countdownHint">• click to set</div>
        </div>
      </div>
    </header>

    <main class="content">
      <section id="homeScreen">
        <div class="card">
          <div class="titleRow">
            <div class="title">Progress</div>
          </div>

          <div class="metersGrid" id="metersGrid"></div>

          <div class="overallBelow" id="overallBelow">
            Overall: 0% <span>(0/0)</span>
          </div>
        </div>
      </section>

      <section id="subjectScreen" class="hidden">
        <div class="card">
          <div class="topbar">
            <div class="back" id="backBtn">← Back</div>
            <div style="color:var(--muted); font-weight:800; font-size:13px;" id="subjectMini"></div>
          </div>

          <div class="subjectHeader">
            <h2 id="subjectTitle">Subject</h2>
            <div class="right" id="subjectRight">0/0 done • 0%</div>
          </div>

          <div class="topics" id="topics"></div>

          <div class="actions">
            <button class="secondary" id="markAll">Mark All</button>
            <button class="secondary" id="clearAll">Clear All</button>
            <button id="resetAll">Reset ALL</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ----------------------------
    // DATA
    // ----------------------------
    const SUBJECTS = {
      "Accounting": [
        "Theoretical Framework",
        "Accounting Process",
        "Bank Reconciliation Statement",
        "Inventories",
        "Depreciation and Amortisation",
        "Bills of Exchange and Promissory Notes",
        "Final Accounts of Sole Proprietors",
        "Financial Statements of Not-for-Profit Organizations",
        "Accounts from Incomplete Records",
        "Partnership and LLP Accounts",
        "Company Accounts"
      ],
      "Business Laws": [
        "Indian Regulatory Framework",
        "The Indian Contract Act, 1872",
        "The Sale of Goods Act, 1930",
        "The Indian Partnership Act, 1932",
        "The Limited Liability Partnership Act, 2008",
        "The Companies Act, 2013",
        "The Negotiable Instruments Act, 1881"
      ],
      "Quantitative Aptitude": [
        "Ratio, Proportion, Indices & Logarithms",
        "Equations",
        "Linear Inequalities",
        "Mathematics of Finance",
        "Permutations and Combinations",
        "Sequence and Series",
        "Sets, Relations & Functions",
        "Differential & Integral Calculus",
        "Number Series, Coding-Decoding, Odd Man Out",
        "Direction Tests",
        "Seating Arrangements",
        "Blood Relations",
        "Statistical Description of Data & Sampling",
        "Measures of Central Tendency & Dispersion",
        "Probability",
        "Theoretical Distributions"
      ],
      "Business Economics": [
        "Introduction to Business Economics",
        "Theory of Demand and Supply",
        "Theory of Production and Cost",
        "Price Determination in Different Markets",
        "Determination of National Income",
        "Business Cycles",
        "Public Finance",
        "Money Market",
        "International Trade",
        "Indian Economy"
      ]
    };

    const STORAGE_KEY = "ca_foundation_tracker_v2";
    const EXAM_DATE_KEY = "ca_exam_date_v2";     // stores ISO YYYY-MM-DD internally
    const EXAM_SET_KEY  = "ca_exam_date_set_v2"; // "1" after user sets once
    const DEFAULT_EXAM_DATE_ISO = "2026-06-01";

    const $ = (id) => document.getElementById(id);
    function safeParse(x){ try { return JSON.parse(x); } catch { return null; } }

    // ----------------------------
    // Progress state
    // ----------------------------
    function defaultState(){
      const st = {};
      for(const subj of Object.keys(SUBJECTS)){
        st[subj] = Array(SUBJECTS[subj].length).fill(false);
      }
      return st;
    }

    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      const parsed = raw ? safeParse(raw) : null;
      const base = defaultState();

      if(!parsed || typeof parsed !== "object") return base;

      for(const subj of Object.keys(base)){
        const arr = Array.isArray(parsed[subj]) ? parsed[subj] : [];
        base[subj] = base[subj].map((_, i) => Boolean(arr[i]));
      }
      return base;
    }

    function saveState(state){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function statsFor(state, subj){
      const arr = state[subj] || [];
      const done = arr.filter(Boolean).length;
      const total = arr.length;
      const pct = total === 0 ? 0 : Math.round((done/total)*100);
      return { done, total, pct };
    }

    function overallStats(state){
      let done = 0, total = 0;
      for(const subj of Object.keys(SUBJECTS)){
        const s = statsFor(state, subj);
        done += s.done;
        total += s.total;
      }
      const pct = total === 0 ? 0 : Math.round((done/total)*100);
      return { done, total, pct };
    }

    // circumference for r=45
    function setRing(arcEl, pctEl, pct){
      const C = 282.74;
      arcEl.style.strokeDashoffset = String(C - (pct/100)*C);
      pctEl.textContent = `${pct}%`;
    }

    function cssId(name){
      return name.toLowerCase().replace(/[^a-z0-9]+/g, "_");
    }

    // ----------------------------
    // Countdown date helpers (DD-MM-YYYY <-> ISO)
    // ----------------------------
    function pad2(n){ return String(n).padStart(2,"0"); }

    function isoToDDMMYYYY(iso){
      // iso: YYYY-MM-DD
      const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(iso);
      if(!m) return "";
      return `${m[3]}-${m[2]}-${m[1]}`;
    }

    function ddmmyyyyToISO(ddmmyyyy){
      // dd-mm-yyyy
      const m = /^(\d{2})-(\d{2})-(\d{4})$/.exec(ddmmyyyy);
      if(!m) return null;
      const dd = Number(m[1]), mm = Number(m[2]), yyyy = Number(m[3]);
      if(mm < 1 || mm > 12) return null;
      if(dd < 1 || dd > 31) return null;

      // validate actual date (handles 31 Feb etc)
      const d = new Date(`${m[3]}-${m[2]}-${m[1]}T00:00:00`);
      if(Number.isNaN(d.getTime())) return null;
      if(d.getFullYear() !== yyyy || (d.getMonth()+1) !== mm || d.getDate() !== dd) return null;

      return `${m[3]}-${m[2]}-${m[1]}`;
    }

    function getExamISO(){
      return localStorage.getItem(EXAM_DATE_KEY) || DEFAULT_EXAM_DATE_ISO;
    }
    function setExamISO(iso){
      localStorage.setItem(EXAM_DATE_KEY, iso);
      localStorage.setItem(EXAM_SET_KEY, "1");
      updateCountdownHeaderUI();
    }
    function hasUserSetExam(){
      return localStorage.getItem(EXAM_SET_KEY) === "1";
    }

    // Update header label/hint based on set status
    function updateCountdownHeaderUI(){
      if(hasUserSetExam()){
        $("countdownLabel").textContent = "Exam In";
        $("countdownHint").style.display = "none";
      }else{
        $("countdownLabel").textContent = "Set Exam Date";
        $("countdownHint").style.display = "inline";
      }
    }

    function startCountdown(){
      function tick(){
        const iso = getExamISO();
        const target = new Date(iso + "T09:00:00");
        const now = new Date();
        let diff = target - now;
        if (Number.isNaN(target.getTime())) diff = 0;
        if (diff < 0) diff = 0;

        const totalSec = Math.floor(diff / 1000);
        const days = Math.floor(totalSec / 86400);
        const hours = Math.floor((totalSec % 86400) / 3600);
        const mins  = Math.floor((totalSec % 3600) / 60);
        const secs  = totalSec % 60;

        $("countdownTime").textContent = `${days}d ${pad2(hours)}:${pad2(mins)}:${pad2(secs)}`;
      }
      tick();
      setInterval(tick, 1000);
    }

    // Interaction rules:
    // - Before date set: click anywhere on pill OR time sets date
    // - After date set: ONLY clicking the time sets date
    function promptSetExamDate(){
      const currentISO = getExamISO();
      const currentDMY = isoToDDMMYYYY(currentISO);
      const input = prompt("Set exam date (DD-MM-YYYY):", currentDMY);
      if(!input) return;

      const iso = ddmmyyyyToISO(input.trim());
      if(!iso){
        alert("Invalid date. Please use DD-MM-YYYY (example: 08-05-2026).");
        return;
      }
      setExamISO(iso);
    }

    $("countdownPill").addEventListener("click", (e) => {
      // if already set, pill click should do nothing
      if(hasUserSetExam()) return;
      promptSetExamDate();
    });

    $("countdownTime").addEventListener("click", (e) => {
      // always allow clicking the time to set/change
      e.stopPropagation();
      promptSetExamDate();
    });

    // ----------------------------
    // NAV + UI
    // ----------------------------
    let currentSubject = null;

    function showHome(){
      $("subjectScreen").classList.add("hidden");
      $("homeScreen").classList.remove("hidden");
      currentSubject = null;
      renderHome();
    }

    function openSubject(subj){
      currentSubject = subj;
      $("homeScreen").classList.add("hidden");
      $("subjectScreen").classList.remove("hidden");
      renderSubject();
    }

    function renderHome(){
      const state = loadState();
      const overall = overallStats(state);
      $("overallBelow").innerHTML = `Overall: ${overall.pct}% <span>(${overall.done}/${overall.total})</span>`;

      const grid = $("metersGrid");
      grid.innerHTML = "";

      for(const subj of Object.keys(SUBJECTS)){
        const {done, total, pct} = statsFor(state, subj);
        const id = cssId(subj);

        const card = document.createElement("div");
        card.className = "meterCard";

        card.innerHTML = `
          <div class="ring" aria-label="${subj} progress">
            <div class="pct" id="pct_${id}">${pct}%</div>
            <svg width="120" height="120" viewBox="0 0 120 120" aria-hidden="true">
              <circle cx="60" cy="60" r="45" fill="none"
                stroke="rgba(255,255,255,.22)" stroke-width="10"></circle>
              <circle id="arc_${id}" cx="60" cy="60" r="45" fill="none"
                stroke="var(--green)" stroke-width="10"
                stroke-linecap="round"
                stroke-dasharray="282.74"
                stroke-dashoffset="282.74"
                transform="rotate(-90 60 60)"></circle>
            </svg>
          </div>

          <div class="subjectName" data-subject="${subj}">${subj}</div>
          <div class="doneText">${done}/${total} done</div>
        `;

        grid.appendChild(card);

        const arc = card.querySelector(`#arc_${id}`);
        const pctEl = card.querySelector(`#pct_${id}`);
        setRing(arc, pctEl, pct);

        const nameEl = card.querySelector(".subjectName");
        nameEl.addEventListener("click", () => openSubject(subj));
      }
    }

    function renderSubject(){
      const state = loadState();
      const subj = currentSubject;

      $("subjectTitle").textContent = subj;

      const {done,total,pct} = statsFor(state, subj);
      $("subjectRight").textContent = `${done}/${total} done • ${pct}%`;
      $("subjectMini").textContent = "";

      const wrap = $("topics");
      wrap.innerHTML = "";

      SUBJECTS[subj].forEach((topic, idx) => {
        const row = document.createElement("div");
        row.className = "topicRow";

        const cbId = `cb_${idx}`;

        row.innerHTML = `
          <div class="topicName">${topic}</div>
          <input type="checkbox" id="${cbId}" />
        `;

        const cb = row.querySelector(`#${cbId}`);
        cb.checked = Boolean(state[subj][idx]);

        cb.addEventListener("change", () => {
          const newState = loadState();
          newState[subj][idx] = cb.checked;
          saveState(newState);

          const s = statsFor(newState, subj);
          $("subjectRight").textContent = `${s.done}/${s.total} done • ${s.pct}%`;

          const overall = overallStats(newState);
          $("overallBelow").innerHTML = `Overall: ${overall.pct}% <span>(${overall.done}/${overall.total})</span>`;
        });

        wrap.appendChild(row);
      });
    }

    $("backBtn").addEventListener("click", showHome);

    $("markAll").addEventListener("click", () => {
      if(!currentSubject) return;
      const state = loadState();
      state[currentSubject] = Array(SUBJECTS[currentSubject].length).fill(true);
      saveState(state);
      renderSubject();
    });

    $("clearAll").addEventListener("click", () => {
      if(!currentSubject) return;
      const state = loadState();
      state[currentSubject] = Array(SUBJECTS[currentSubject].length).fill(false);
      saveState(state);
      renderSubject();
    });

    $("resetAll").addEventListener("click", () => {
      localStorage.removeItem(STORAGE_KEY);
      if(currentSubject) renderSubject();
      else renderHome();
    });

    // init
    updateCountdownHeaderUI();
    startCountdown();
    renderHome();
  </script>
</body>
</html>
