<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CA Foundation Tracker</title>

  <!-- ‚úÖ Correct for GitHub Pages subfolder hosting -->
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="app">
    <header class="hero">
      <div class="hero-inner">
        <div class="brand">
          <h1>CA Foundation Tracker</h1>
        </div>

        <div class="hero-actions">
          <button class="ribbonTimerBtn" id="openTimerBtn" type="button">Set Timer</button>

          <div class="countdownPill" id="countdownPill" title="Click to set/change exam date">
            <div class="time" id="countdownTime">SET EXAM DATE</div>
          </div>
        </div>
      </div>
    </header>

    <main class="content">
      <!-- Quote -->
      <div class="quoteCard">
        <div class="quoteText" id="quoteText">Loading quote...</div>
      </div>

      <!-- HOME SCREEN -->
      <section id="homeScreen">
        <div class="card">
          <div class="titleRow">
            <div class="title">Progress</div>

            <!-- ‚úÖ LEFT of theme toggle: Public Discussion Forum button -->
            <div class="titleRowRight">
              <button class="secondary smallBtn" id="forumNavBtn" type="button" aria-label="Open Public Discussion Forum">
                Public Discussion Forum
              </button>

              <button class="themeToggle" id="themeToggle" type="button" aria-label="Toggle theme">
                <span class="themeIcon" id="themeIcon">üåô</span>
                <span class="themeText" id="themeText">Dark</span>
              </button>
            </div>
          </div>

          <!-- Progress Rings -->
          <div class="metersGrid" id="metersGrid"></div>

          <!-- Overall -->
          <div class="overallBelow" id="overallBelow">
            Overall: 0% <span>(0/0)</span>
          </div>

          <!-- Extras grid -->
          <div class="extrasGrid">
            <!-- To-Do -->
            <div class="todoCard" id="todoCard">
              <div class="todoHeader">
                <div class="todoTitle">To-Do List</div>
              </div>

              <div class="todoInputRow">
                <input type="text" id="todoInput" placeholder="Add a task..." />
                <button id="addTodoBtn" type="button">Add</button>
              </div>

              <div class="todoList" id="todoList"></div>
            </div>

            <!-- Quick Links -->
            <div class="quickLinksCard">
              <div class="quickTitle">Quick Links</div>

              <a class="quickLink" href="https://www.icai.org/post/foundation-nset" target="_blank" rel="noopener">
                ICAI Study Material
              </a>
              <a class="quickLink" href="https://www.icai.org/post/rtp-foundation-course" target="_blank" rel="noopener">
                RTP
              </a>
              <a class="quickLink" href="https://resource.cdn.icai.org/84774bos68243.pdf" target="_blank" rel="noopener">
                MTP
              </a>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚úÖ PUBLIC DISCUSSION FORUM SCREEN (Input TOP, messages BELOW) -->
      <section id="forumScreen" class="hidden">
        <div class="card">
          <div class="topbar">
            <div class="back" id="forumBackBtn">‚Üê Back</div>
          </div>

          <div class="chatInputRow">
            <input type="text" id="forumInput" placeholder="Type your message‚Ä¶" maxlength="220" disabled />
            <button id="forumSendBtn" type="button" disabled>Send</button>
          </div>

          <div class="chatMessages" id="forumMessages"></div>

          <!-- hidden status for JS safety -->
          <div id="forumStatus" class="hidden">Offline</div>
        </div>
      </section>

      <!-- SUBJECT SCREEN -->
      <section id="subjectScreen" class="hidden">
        <div class="card">
          <div class="topbar">
            <div class="back" id="backBtn">‚Üê Back</div>
            <div class="subjectMini" id="subjectMini"></div>
          </div>

          <div class="subjectHeader">
            <h2 id="subjectTitle">Subject</h2>
            <div class="right" id="subjectRight">0/0 done ‚Ä¢ 0%</div>
          </div>

          <div class="topics" id="topics"></div>

          <div class="actions">
            <button class="secondary" id="markAll" type="button">Mark All</button>
            <button class="secondary" id="clearAll" type="button">Clear All</button>
            <button class="secondary" id="resetAll" type="button">Reset ALL</button>

            <div class="actionsSpacer"></div>
            <button id="doneBtn" type="button">Done</button>
          </div>
        </div>
      </section>

      <!-- TIMER MODAL -->
      <div class="timerModal hidden" id="timerModal">
        <div class="timerPanel">
          <div class="timerTop">
            <div class="timerTitle">Study Timer</div>
            <button class="timerClose" id="closeTimerBtn" type="button">‚úï</button>
          </div>

          <div class="timerBig" id="timerBig">00:00</div>

          <div class="timerSetup">
            <div class="timerInputs" id="timerInputs">
              <div class="timerField">
                <label for="timerMin">Minutes</label>
                <input type="number" id="timerMin" min="0" max="999" value="5"/>
              </div>
              <div class="timerField">
                <label for="timerSec">Seconds</label>
                <input type="number" id="timerSec" min="0" max="59" value="0"/>
              </div>
            </div>

            <div class="timerBtns">
              <button class="timerBtn" id="startTimerBtn" type="button">Start</button>
              <button class="timerBtn secondary" id="pauseTimerBtn" type="button" disabled>Pause</button>
              <button class="timerBtn secondary" id="resetTimerBtn" type="button" disabled>Reset</button>
            </div>

            <div class="timerHint" id="timerHint">Set time and press Start.</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- USER CAPTURE MODAL -->
  <div class="userModal hidden" id="userModal">
    <div class="userPanel">
      <div class="userTop">
        <div class="userTitle">Welcome üëã</div>
      </div>

      <div class="userSub">Enter your name & email to save your progress.</div>

      <form id="userForm" class="userForm">
        <div class="userField">
          <label for="userName">Name</label>
          <input id="userName" type="text" placeholder="Your name" required />
        </div>

        <div class="userField">
          <label for="userEmail">Email</label>
          <input id="userEmail" type="email" placeholder="you@example.com" required />
        </div>

        <button class="userBtn" type="submit">Continue</button>
        <div class="userMsg" id="userMsg"></div>

        <div class="userConsent">
          By continuing, you agree we may store your name & email to save your progress.
        </div>
      </form>
    </div>
  </div>

  <!-- ALARM POPUP -->
  <div class="alarmOverlay hidden" id="alarmOverlay">
    <div class="alarmBox">
      <div class="alarmTitle">‚è∞ Time‚Äôs up!</div>
      <div class="alarmMsg">Press OK to stop the alarm.</div>
      <button class="alarmOk" id="alarmOkBtn" type="button">OK</button>
    </div>
  </div>

  <!-- ‚úÖ Helps you see EXACT errors -->
  <script>
    window.addEventListener("error", (e) => {
      console.error("Script error:", e.message, e.filename, e.lineno);
    });
    window.addEventListener("unhandledrejection", (e) => {
      console.error("Promise rejection:", e.reason);
    });
  </script>

  <!-- ‚úÖ MUST be module if app.js uses Firebase modular imports -->
  <script type="module" src="./app.js?v=101"></script>
</body>
</html>
